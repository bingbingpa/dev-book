### 11. 컨텍스트에 맞는 API 디자인하기
- 목표와 데이터에 맞게 커뮤니케이션 적용하기
- 컨슈머와 프로바이더의 요구사항과 한계를 고려하기
- 컨텍스트에 맞는 API 스타일 선택하기
    #### 11.1 데이터와 목표와 성격에 맞는 커뮤니케이션 적용하기
    - 컨슈머에서 프로바이더까지의 통신은 항상 효율적인 방식으로 이뤄지진 않는다. 그리고 때로는 프로바이더가 주도권을 갖는 편이 더 유용하게 돌아갈 수도 있다.
    - 컨슈머/프로바이더의 통신 방향을 역으로 뒤집은 것은 **웹훅**(webhook)을 통해 할 수 있으며, 이는 종종 리버스 API 라고도 불린다.
    - 웹훅 API 를 디자인할 때도 프로바이더의 관점을 지양해야 하며, 사용 가능하고 발전 가능하게 디자인해야 한다.
    - 이벤트 흐름 스트리밍하기
        - **SSE**(Server Sent Event) : 서버의 데이터를 실시간으로, 지속적으로 Streaming 하는 기술이다. SSE 는 웹 표준으로써 IE를 제외한 모든 브라우저에서 지원되며, IE 역시 polyfill 을 통해 지원이 가능하다.
        - 컨슈머는 콘텐트 타입을 **text/event-stream** 으로 보낸다.
        - 반환된 데이터는 정적이지도 않으며 아직 종결된 상태도 아니며 스트림 형태로 제공된다.
        - SSE 는 HTTP 프로토콜에 의존하기 때문에 별도의 인프라 구성이 필요하지 않다.
        - **SSE 를 사용하면 기본적으로 HTTP 연결이 오랜 시간 동안 열려 있을 수 있으므로, API 를 호스팅하는 인프라에서는 이러한 긴 병렬연결을 유지하고 성능 이슈가 없도록 튜닝이 필요하다.**
        - SSE 는 서버에서 컨슈머로 향하는 단방향 통신만 제공하지만 WebSocket 은 단방향, 양방향 모두를 지원한다. 
    - multi request 를 하는 경우 응답 처리 
        - **207 Multi-Status** 리스폰스를 사용한다.
        - 207 Multi Status 리스폰스는 items 속성이 있는 오브젝트로, 리퀘스트에 포함된 요소의 개수와 동일한 개수의 요소를 반환한다.
        - multi request 에 대한 각각의 status 를 담아서 내려주도록 하자. 
        - 비즈니스 로직에 따라서는 처리 가능한 일부만 처리하는 것은 문제가 될 수도 있다. 만약 부분 처리 방식이 합당하지 않은 경우라면, API 는 성공시 전통적인 200 OK 와 실패의 경우엔 400 Bad Request 를 반활 할 수 있다.
        - API 는 단일 리소스만 처리해야 한다는 법은 없다. 경우에 따라 한 번의 호출로 여러 리소스를 처리하는 것이 유용한 컨텍스트가 있다. 적절히 잘 사용하도록 하자. 
    - 민감한 정보는 쿼리 파라미터로 취급해서는 안된다. 어딘가에 로그라도 남으면 안되니깐!
    #### 11.2 컨텍스트에 맞는 API 스타일 선택하기
    - REST 는 리소스 기반이며, gRPC 는 함수 기반이며, GraphQL 은 데이터 기반이며, 이것들은 저마다 장단점을 지니고 있다.
        - gRPC(google Remote Procedure Call)
            - 단순하게 함수를 외부에 노출하는 방식이다. 예) 소유자 123의 정보를 읽어오는 것은 readOwner(123) 함수를 호출한다.
            - gRPC 프레임워크는 HTTP 1.1 이나 2 프로토콜에 별도의 변경 없이 전송계층으로 사용한다. 
            - gRPC 는 표준 캐싱 메커니즘을 제공하지 않는다. 
            - 프로토콜 버퍼 데이터 포맷을 사용 할 수 있어서 XML 이나 JSON 과 다르게 장황하지 않다. 
            - 사용을 고려할 때
                - 내부 애플리케이션에서 또 다른 내부 애플리케이션의 통신으로 속도가 정말 중요한 경우
                - 캐싱에 관심이 없거나, HTTP 에 의존하지 않고 모든 것을 처리할 의사가 있는 경우
                - API 를 외부에 공개하거나 파트너와 공유할 계획이 없는 경우
        - GraphQL
            - Facebook 에서 만든 API 용 쿼리 언어
            - 기본적으로 데이터 스키마에 접근하여 컨슈머가 정확히 필요한 데이터를 가져갈 수 있게 재공해주는 것이다.  
            - 프로토콜에 구애받지 않고, 리퀘스트를 보내고 리스폰스를 받을 수 있다면 어떠한 프로토콜이건 다 사용할 수 있다.
            - 사용을 고려할 때
                - 고급 쿼리 기능이 필요한 경우
                - API 를 외부에 공개하거나 파트너들과 공유할 계획이 전혀 없는 경우
                - 캐싱이 필요하지 않은 경우
                - 기저의 시스템들이 구현 수준에서 잘 보호 받고 있거나 무한대의 확장성을 보장받을 경우
