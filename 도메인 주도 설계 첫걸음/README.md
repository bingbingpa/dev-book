# 도메인 주도 설계 첫걸음

- *블라드 코노노프 저/김민석, 오창윤 역 | 위키북스*
- 코드 예제
  - [https://learning-ddd.com](https://learning-ddd.com)
  - [https://github.com/wikibook/lddd](https://github.com/wikibook/lddd)

## 01 비즈니스 도메인 분석하기

- 효과적인 솔루션을 설계하고 구축하기 위해서는 그것의 바탕이 되는 문제를 이해해야 한다.
  - 문제를 이해하려면 그것이 존재하는 맥락을 이해해야 한다. 즉, 얻고자 하는 가치를 이해해야 한다.
- 하위 도메인은 비즈니스 활동의 세분화된 영역이다. 각각의 하위 도메인은 회사의 비즈니스 도메인에서 목표를 달성하기 위해 서로 상호작용해야 한다.
- 도메인 주도 설계에서 하위 도메인은 `핵심`, `일반`, `지원`의 세 가지 유형으로 구분한다.
- 핵심 하위 도메인(core subdomain)
  - 회사가 경쟁업체와 다르게 수행하고 있는 것. 가령 새로운 제품이나 서비스를 발명하거나 기존 프로세스를 최적화하여 비용을 줄이는 것이 그렇다.
  - 회사의 경쟁 우위를 제공한다.
- 일반 하위 도메인(generic subdomain)
  - 모든 회사가 같은 방식으로 수행하는 비즈니스 활동
  - 회사에 경쟁력을 제공하지는 않는다.
- 지원 하위 도메인(supporting subdomain)
  - 회사의 비즈니스를 지원하는 활동
- 소프트웨어 설계 의사결정에 미치는 영향
  - 경쟁 우위
    - 핵심 하위 도메인만이 회사에 경재 우위를 제공한다. 경쟁사와 차별화 하기 위한 회사의 전략이다.
  - 복잡성
    - 소프트웨어를 설계할 때 우리는 비즈니스 요구사항의 복잡성을 수용할 수 있는 도구와 기술을 선택해야 한다.
    - 핵심 하위 도메인은 복잡하다. 회사의 수익성이 좌우되기 때문에 경쟁업체가 최대한 모방하기 어려워야 한다.
    - 소프트웨어 설계에 영향을 미치는 복잡한 핵심 하위 도메인을 식별하는 것이 중요하다.
  - 변동성
    - 핵심 하위 도메인은 자주 변경될 수 있다. 다만, 다양한 구현 방법을 시도하고 개선하고 최적화해야 가능핟.
      - 핵심 하위 도메인에 대한 개선 작업은 끝이 없다. 기업은 지속적으로 혁신하고 발전한다.
      - 경쟁사보다 앞서기 위해서 핵심 하위 도메인의 지속적인 진화는 필수적이다.
  - 솔루션 전략
    - 유지보수가 불가능한 코드는 회사의 목표를 지원할 수 없다.
    - 핵심 하위 도메인의 요구사항은 자주 그리고 지속적으로 변경될 것으로 예상되므로 솔루션은 유지보수가 가능하고 쉽게 개선될 수 있어야 한다.
- 하위 도메인의 경계를 식별 하기 위해서 회사의 부서와 기타 조직 단위는 좋은 출발점이다.
  - 예를 들어, 온라인 쇼핑몰이라면 창고, 고객 서비스, 출고, 배송, 품질관리 등이 포함될 수 있다.
- 크게 나눈 하위 도메인은 좋은 출발점이지만, 문제는 세부 사항에 있다. 비즈니스 기능의 복잡한 내용에 숨겨진 중요한 정보를 놓치지 않아야 한다.
- 더 세부적인 통찰력을 얻기 위해 무한정 파헤칠 수는 없다. 도대체 언제 멈춰야 할까?
  - 응집된 유스케이스르 하위 도메인으로 나눈다.
    - 하위 도메인은 상호 연관되고 응집된 유스케이스의 집합과 유사하다.
    - 이러한 유스케이스 집합에서는 보통 동일한 행위자(actor), 비즈니스 엔티티(business entity)를 포함하고 모두 밀접하게 관련된 데이터의 집합을 다룬다.
    - 세분화된 하위 도메인을 찾는 것을 중단하는 시점을 결정하기 위한 지침으로 '응집된 유스케이스의 집합인 하위 도메인'이라는 정의를 사용할 수 있다.
- 도메인 전문가(domain expert)
  - 우리가 모델링하고 코드로 구현할 비즈니스의 모든 복잡성을 알고 있는 주제 전문가
  - 일반적으로 도메인 전문가는 요구사항을 제시하는 사람 또는 소프트웨어의 최종 사용자다.

## 02 도메인 지식 찾아내기

운영환경에 배포되는 것은 도메인 전문가의 지식이 아니라 개발자의 이해 혹은 오해다. - *알베르토 브랜돌리니*

- 비즈니스 도메인의 컨텍스트에서 '문제'의 의미는 광범위하다. 비즈니스 문제는 워크플로와 프로세스 최적화, 수작업 최소화, 자원 관리, 의사결정 지원
  데이터 관리 등과 관련한 과제일 수 있다.
- 효과적인 소프트웨어 솔루션을 설계하려면 적어도 기본적인 비즈니스 도메인 지식이 있어야 한다.
- 문서화된 커뮤니케이션은 최신 정보를 담아내지 못한다.
- 유비쿼터스 언어
  - 유비쿼터스 언어를 사용하는 것은 도메인 주도 설계의 초석이다.
    - 참가자들이 효과적으로 소통하기 위해 변환에 의존하지 말고 같은 언어를 사용하는 것
    - 비즈니스 도메인을 설명하기 위한 단일화된 언어 체계가 바로 유비쿼터스 언어다.
    - 기술 용어는 빼고 비즈니스 도메인에 관련된 용어로만 구성해야 한다.
  - 반드시 정확하고 일관성이 있어야 한다. 모호성이 커뮤니케이션을 방해하기 때문에 유비쿼터스 언어의 용어는 오직 하나의 의미를 가져야 한다.
  - 동의어를 사용하지 않도록 주의하자. 특정 컨텍스트 안에서 각각의 용어를 사용하는 것이 바람직하다.
  - **유비쿼터스 언어는 대화, 문서화, 테스트, 다이어그램, 소스코드 등 프로젝트 전반에 걸쳐 모든 이해관계자가 공유된 언어를 사용함으로써 커뮤니케이션과 지식공유를 강화한다.**
- 비즈니스 도메인 모델
  - 모델은 실세계의 복제가 아니라 우리가 실제 시스템을 이해하는 데 도움을 주는 인간의 창조물이다.
  - 예를 들면, 길안내 지도, 지형도, 세계 지도
    - 지도 중 어느 것도 우리 행성의 세부적인 것을 모두 나타내지는 않는다. 대신, 각 지도는 특정 목적을 지원하는 데 충분한 자료만 담고 있다.
- 효과적인 모델링
  - 모든 모델에는 목적이 있고 효과적인 모델은 그 목적을 달성하는 데 필요한 세부사항만 포함한다.
  - 유용한 모델은 실세계의 복사본이 아니라 문제를 해결하려는 의도가 있으며, 그 목적에 필요한 정보만 제공해야 한다.
  - 모델은 본질적으로 추상화의 결과다.
  - 추상화의 목적은 모모함이 아니라 절대적으로 정확할 수 있는 새로운 의미론적 수준을 만드는 것이다. - *에츠허르 데이크스트라*
- 비즈니스 도메인 모델링
  - 모델은 필요한 시스템을 구현하는 데, 즉 소프트웨어가 해결하고자 하는 특정 문제를 해결하는 데 필요한 만큼의 비즈니스 도메인 관점을 포함하면 된다.
  - 비즈니스 도메인의 이해를 확인할 신뢰성 있는 유일한 방법은 도메인 전문가가 이해할 수 있는 비즈니스 언어로 대화하는 것이다.
- 유비쿼터스 언어에 대한 용어집을 관리하자.
  - 이런 용어집은 비즈니스 도메인의 용어에 대한 정보를 얻을 수 있는 거점 역할을 하므로 새로운 팀원이 쉽게 적응하게 해준다.
  - 다 함께 용어집을 유지보수 하는 것이 중요하다.
    - 유비쿼터스 언어가 변경되면 모든 팀원이 수정할 수 있게 독려해야 한다.
- 용어집은 명사(noun)에만 효과적이다.
  - 행동은 단순히 명사와 관련된 동사의 목록이 아니라 규칙, 가정, 그리고 불변성을 가진 실제 비즈니스 로직이다. 이런 개념은 용어집으로 문서화하기 훨씬 어렵다.
  - 유스케이스 또는 거킨 테스트(Gherkin test)처럼 행동을 포착하는 데 적합한 다른 도구와 함께 사용하는 것이 가장 좋다.
    - given/when/then 에 테스트 시나리오를 작성
