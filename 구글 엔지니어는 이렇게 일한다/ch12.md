# CHAPTER 12 단위 테스트

- ‘크기’는 테스트가 소비하는 자원과 수행할 수 있는 작업을 뜻하며, ‘범위’는 테스트가 검증하고자 하는 코드의 양을 의미한다.
- 변하지 않는 테스트로 만들기 위해 노력하자.
- 제품 코드의 변경 유형과 테스트가 어떻게 대응해야 하는지?
    - 순수 리팩토링
        - 외부 인터페이스는 놔두고 내부만 리팩터링한다면 테스트는 변경되지 않아야 한다.
        - 이 경우 테스트의 역할은 리팩터링 후에도 시스템의 행위가 달라지지 않음을 보장하는 것이다.
        - 리팩터링 과정에서 테스트를 변경해야 한다면 원인은 둘 중 하나다.
            1. 시스템의 행위가 달라졌다는 뜻이다. 순수 리팩터링이 아니었던 것이다.
            2. 테스트의 추상화 수준이 적절하지 않았다는 뜻이다. **테스트가 대상의 세부 구현 방식에 지나치게 의존하고 있었다는 것이다.**
    - 새로운 기능 추가
        - 새로운 기능이나 행위를 추가할 때는 기존 행위들에 영향을 주지 않아야 한다.
        - 새 기능을 검증할 테스트를 새로 작성해야 하며, 기존 테스트들은 변경되지 않아야 한다.
        - 새 기능을 추가했는데 기존 테스트를 변경해야 한다면 해당 테스트가 검증하는 기능에 의도치 않은 영향을 주었거나 테스트 자체에 문제가 있다는 뜻이다.
    - 버그 수정
        - **버그 수정과 동시에 바로 그 누락 됐던 테스트를 추가해야 한다.**
- **내부 구현을 위한 코드가 아닌 공개 API 를 이용해 테스트 하자. 즉, 테스트가 시스템을 사용자와 똑같은 방식으로 사용하는 것이다.**
- **상호 작용이 아니라 상태를 테스트하자!!!**
    - 시스템이 기대한 대로 동작하는지 검증하는 방법 두 가지
        1. `상태 테스트` (state test): 메서드 호출 후 시스템 자체를 관찰한다.
        2. `상호작용 테스트` (interaction test): 호출을 처리하는 과정에서 시스템이 다른 모듈(시스템)들과 협력하여 기대한 일련의 동작을 수행하는지를 확인한다.
    - 대체로 상호작용 테스트는 상태 테스트보다 깨지기 쉽다. 우리가 진짜로 원하는 것은 결과가 ‘무엇’이냐지만, 상호작용 테스트는 결과에 도달하기까지 시스템이 ‘어떻게’ 작동하냐를 확인하려고 한다.
- **진짜 객체가 빠르고 결정적이라면 테스트 대역을 지양하고 진짜 객체를 사용해야 한다.**
- 명확한 테스튼 대상 시스템의 문서자료 역할을 해주고 새로운 테스트를 작성하기 쉽게 도와주는 토대가 되어주는 등의 이점도 제공한다.
- 테스트 하나하나가 최대한 명확해야 한다.
- 테스트 본문에는 테스트를 이해하는 데 필요한 정보를 모두 담아야 하며, 그와 동시에 눈을 어지럽히거나 관련 없는 정보는 담지 않아야 한다.
- **테스트는 메서드별로 작성하지 말고 행위별로 작성하자.**
    - `행위` 란 특정 상태에서 특정한 일련의 입력을 받았을 때 시스템이 보장하는 ‘반응’을 뜻한다.
    - 행위를 때로는 given/when/then 을 써서 표현하기도 한다.
    - 여러 단계로 진행되는 작업을 단계별로 검증하고 싶을 때는 when 과 then 블록을 교대로 정의하는 방법도 있다. 또한 긴 블록은 쪼갠 후 ‘그리고(and)’ 접속사로 연결해주면 더 잘 읽힌다.
    - 긴 테스트를 작성할 때는 동시에 여러 행위를 검사하는 실수를 범하지 않도록 주의해야 한다. 테스트 각각은 단 하나의 행위만 다뤄야 하며, 따라서 절대다수의 단위 테스트는 when 과 then 블록이 하나씩이면 충분하다.
- 테스트 이름이 ‘and’ 가 들어간다면 아마도 여러 가지 행위를 검사하고 있을 가능성이 크다. 정말 그렇다면 테스트를 쪼개야 한다.
- 테스트 코드에서는 스마트한 로직보다 직설적인 코드를 고집해야 한다. 또한 서술적이고 의미 있는 테스트를 만들기 위한 약간의 중복은 허용하는 것이 좋다.
- **좋은 실패 메시지라면 기대한 상태와 실제 상태를 명확히 구분해 주고 결과가 만들어진 맥락 정보도 더 제공해야 한다.**
- 셋업 메서드가 이용한 특정 값에 의존하는 테스트가 생겨나기 시작하면 악몽이 시작될 수 있다…