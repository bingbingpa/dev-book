# CHAPTER 18 빌드 시스템과 빌드 철학

- Bazel: 구글이 만든 오픈소스 빌드 시스템([https://bazel.build/](https://bazel.build/))
- 의존성을 관리하는 일이 빌드 시스템 구축에서 가장 기본이 되는 작업이다.
- 태스크 기반 빌드 시스템의 어두운 면
    - 태스크 기반 빌드 시스템은 빌드 스크립트가 커져서 복잡해질수록 다루기가 어려워진다.
        - 시스템은 스크립트가 무얼 하는지 알 수 없으므로 각각의 빌드 단계를 매우 보수적으로 실행할 수밖에 없고, 결국 성능 문제로 이어진다.
        - 또한 시스템은 각 스크립트가 할 일을 올바르게 수행하고 있는지 확인할 방법이 없다.
        - 그래서 엔지니어들은 디버깅이 필요할 정도까지 스크립트 자체를 복잡하게 만드는 경향이 생긴다.
    - 스크립트를 유지보수하고 디버깅하기 어렵다.
- 태스크 기반 프레임워크에서는 성능, 정확성, 유지보수성 문제를 한꺼번에 해결할 수 있는 방법이 없다.
    - 빌드 중에 실행되는 임의의 코드(빌드 스크립트)를 엔지니어가 작성할 수 있다는 것은 빌드를 빠르고 정확하게 수행하는데 필요한 정보 일부가 누락될 수 있다는 뜻이다.
    - 이 문제를 풀려면 엔지니어 손에 주어진 힘 일부를 빼앗아 시스템에 맡겨야 한다.
    - 즉, 시스템이 태스크를 실행한다는 개념에서 벗어나 아티팩트를 만들어낸다는 쪽으로 이동해야 한다.
- `아티팩트 기반 빌드 시스템`은 엔지니어는 여전히 시스템에게 ‘무엇’을 빌드할지 정해줄 수 있지만 ‘어떻게’는 시스템이 알아서 하도록 맡기는 것이다.
- `분산 빌드` 란 단위 작업들을 여러 컴퓨터에 뿌려 빌드한 후 취합해 최종 결과를 만들어주는 기술이다.
    - `원격 캐시` 란 빌드를 수행하는 모든 시스템, 즉 개발자 컴퓨터와 지속적 통합 시스템 모두 공통의 원격 캐시 서비스를 참조하는 모양새다.
        - 원격 캐시 시스템이 제역할을 하려면 빌드 시스템이 빌드를 완벽하게 재현할 수 있어야 한다.
        - 즉, 모든 타깃에 대해서 필요한 입력 집합을 결정할 수 있고, 같은 입력이 주어지면 어떤 머신에서 빌드하더라도 정확하게 같은 결과가 나와야 한다.
        - 그래야만 다운로드한 아티팩트가 직접 새로 빌드하는 결과와 동일함을 보장할 수 있다.
        - 아티팩트를 다운로드 하는 시간이 새로 빌드할 때보다 빨라야 원격 캐시가 의미가 있다.
        - 빌드 결과가 빠르게 공유되도록 네트워크와 빌드 시스템을 세심히 튜닝해야 한다.
    - `원격 실행` 이란 빌드를 하는 ‘실제’ 작업들을 여러 워커에 나눠 수행하는 기술이다.
- **빌드 시스템의 역할은 세월이 흐르고 규모가 커져도 코드를 쉽게 다룰 수 있게 해주는 것이다.**
- 빌드 시스템 교체는 비용이 많이 드는 일이다. 프로젝트가 커질수록 비용이 커진다.
- 모듈의 가시 범위는 가능한 한 좁히는게 좋다.
- 자동 의존성 관리는 작은 프로젝트에서는 편리하지만 조금만 큰 프로젝트에서는 혹은 두 명 이상이 진행하는 프로젝트에서는 대체로 재앙을 몰고 온다. 자동 관리의 문제는 의존성의 버전이 언제 업데이트 되는지를 통제할 수 없다는 것이다.
- Maven 과 Gradle 같은 빌드 도구는 기본적으로 전이 의존성을 재귀적으로 다운로드한다. 따라서 프로젝트에 추가한 의존성 하나가 수십 개의 아티팩트를 다운로드하게 만들 수 있다.
    - 둘 이상의 라이브러리가 똑같은 서드파티 라이브러리의 상이한 버전을 사용할 가능성이 있다.
- **때로는 엔지니어의 힘과 유연성을 제한해야 생산성을 높일 수 있다.**
    - 대신 고도로 구조화된 프레임워크를 개발하여 개인의 선택을 제한하고 가장 중요한 결정을 자동화 도구에 위임하자.
- **조직이 성장해도 개발자들의 생산성을 유지하려면 제대로 된 빌드 시스템이 반드시 필요하다.**
- 아티팩트 중심으로 구성된 빌드 시스템이 태스크 중심 빌드 시스템보다 확장성과 안정성 모두 뛰어나다.