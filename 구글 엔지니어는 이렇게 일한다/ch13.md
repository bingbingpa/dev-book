# CHAPTER 13 테스트 대역

- `테스트 대역` 은 실제 구현 대신 사용 할 수 있는 객체나 함수를 말한다.
- 테스트 대역을 사용하려면 코드베이스가 테스트하기 쉽도록 설계되어 있어야 한다.
    - 예켠대 데이터베이스를 호출하는 코드라면 실제 데이터베이스 대신 테스트 대역을 사용해도 괜찮을 만큼 유연해야 한다. 테스트를 염두에 두지 않고 설계된 코드라면 상당히 많이 리팩터링 해야 할 것이다.
- `가짜 객체` 는 제품 코드로는 적합하지 않지만 실제 구현과 비슷하게 동작하도록 가볍게 구현한 대역이다.
    - 인메모리 데이터베이스가 좋은 예이다.
- `스텁` 은 원래는 없던 행위를 부여하는 과정을 말한다. 예컨대 대상 함수가 반환할 값을 지정한다고 하면, 이를 ‘반환값을 뭉갠다(스텁한다)’라고 말한다.
    - 원래의 동작을 무시하고(뭉개고) 테스트가 지정한 동작을 수행하도록 하는 모습을 빗댄 용어이다.
- **단위 테스트들이 테스트 대역에 너무 의존한다면 엔지니어가 통합 테스트를 추가로 수행해보거나 수동으로 직접 동작시켜봐야 같은 수준의 확신이 생길 것이다.**
- `값객체(value object)` 라면 실제 구현을 사용해야 한다.
    - 금액, 날짜, 주소, 혹은 리스트나 맵 같은 컬렉션 클래스가 대표적인 값 객체이다.
- 실제 구현의 수행 시간이 오래 걸릴 때는 테스트 대역이 유용할 수 있다.
- 테스트에서 데이터베이스를 사용할 수 없다면 데이터베이스 API 를 호출하는 클래스 각각이 아니라 데이터베이스 API 자체만 가짜 객체로 만들자.
- **실제 구현과 다르게 동작한다면 가짜 객체를 이용하는 테스트들은 쓸모가 없어진다.**
- **스텁을 이용하면 대상 시스템의 내부 구현 방식이 테스트에 드러난다. 제품의 내부가 다르게 구현되면 테스트 코드도 함께 수정해야 한다. 좋은 테스트라면 사용자에게 영향을 주는 공개 API 가 아닌 한, 내부가 어떻게 달라지든 영향받지 않아야 한다.**
- 스텁은 실제 구현을 포괄적으로 대체하기보다는 특정 함수가 특정 값을 반환하도록 하여 대상 시스템을 원하는 상태로 변경하려 할 때 제격이다.
- 목적이 분명하게 드러나게 하려면 스텁된 함수 하나하나가 단정문들과 직접적인 연관이 있어야 한다. 그래서 테스트들은 대체로 적은 수의 함수만 스텁으로 대체한다. 스텁된 함수가 많을수록 테스트의 의도는 희미해질 것이다.
- `상호작용 테스트` 는 대상 함수의 구현을 ‘호출하지 않으면서’ 그 함수가 어떻게 호출되는지를 검증하는 기법이다.
    - 예) 모의 객체 프레임워크를 활용하는 경우
    - 상호작용 테스트의 가장 큰 문제는 대상 시스템이 특정 함수가 호출 되었는지만 알려줄 뿐, 올바르게 작동하는지는 말해주지 못한다는 점이다. 그래서 해당 코드가 올바르게 동작한다고 ‘가정하고 넘가아야’ 한다.
    - 상호작용 테스트는 상태 테스트를 완전히 대체하지 못한다. 따라서 단위 테스트에서 상태 테스트를 수행할 수 없다면 상호작용 테스트를 추가하는 대신 더 큰 범위의 테스트 스위트에서 상태 테스트를 수행하여 보완하는게 좋다.
        - 예를 들어 데이터베이스를 검증하는 단위 테스트에서 상호작용 테스트를 수행하고 있다면 통합 테스트 단에서 실제 데이터베이스를 대상으로 한 상태 테스트로 해결할 수 있는지 확인해보자.
    - 일반적으로 상호작용 테스트는 상태 변경 함수에 한해서만 수행해야 한다.
- 어떤 함수들이 어떤 인수들을 받아 호출되는지를 너무 세세하게 검증하지 않는게 좋다. 그래야 테스트가 더 명확하고 간결해진다. 나아가 각 테스트의 범위를 벗어난 행위로 인한 변경의 영향을 덜 받으므로 함수 호출 방식이 달라져도 실패하는 테스트의 수도 줄어든다.