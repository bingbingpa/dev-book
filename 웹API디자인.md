# 일상 속 사물이 알려주는 **웹 API디자인**

### 1. API디자인이란 무엇인가?

- API 는 함수를 통해서 데이터를 입력하고, 또는 출력하는 피드백을 제공한다. 이러한 함수들은 애플리케이션끼리 정보를 검색, 전달하거나 특정한 작업을 유도할 수 있다.
- API 는 기본적으로 소프트웨어를 재사용 가능한 블록으로 만들어 다른 누군가가 손쉽게 조립해 무엇이든 할 수 있게 해준다.
- API 의 개발자 경험(DX, Developer experience) 이란 API 를 사용하는 개발자들의 경험을 의미한다.
- API 를 디자인할 때 실제로 무슨 일이 벌어질 것인지 세부 구현을 고민해야 한다.
- **API 디자인을 할 때는 반드시 커스터머의 측면과 프로바이더 측면으로 인터페이스의 두 가지 면을 고려해야 한다.** 
- 좋은 API 를 디자인하기 위해서는 인터페이스뿐만 아닌 모든 컨텍스트를 고려해야 한다. 

### 2. 사용자를 위한 API 디자인하기

- 서로 연관된 포괄적인 요구사항들을 정리할 수 있도록 **컨슈머의 관점**에 중점을 두어야 한다.
  #### 2.1 일상 속 사용자 인터페이스를 디자인하는 올바른 관점
    - 작업 방식에 집중하면 인터페이스가 복잡해진다.
    - 사용자가 할 수 있는 일에 집중하면 인터페이스는 단순해진다.
  #### 2.2 소프트웨어 인터페이스 디자인 방법 
    - API 를 소프트웨어의 제어판처럼 바라보기
    - 컨슈머의 관점에 집중해 단순한 API 만들기
  #### 2.3 API 의 목표 식별 과정 
    - API 를 디자인할 때 기본적으로 다음과 같은 사항들을 깊이 있고, 정확하게 이해해야 한다. 
      - 누가 사용자인가?
      - 그들은 무엇을 할 수 있는가?
      - 그들은 그걸 어떻게 하는가?
      - 그들은 그것을 하기 위해 무엇이 필요한가?
      - 그들은 무엇을 반환받는가?
      - 입력은 어디를 통해서 들어오는가?
      - 출력은 어디에서 어떻게 쓰이는가?
    - API 목표 캔버스
      - 누가 - API 를 사용하는 사용자들(또는 프로파일들)을 나열 
      - 무엇을 - API 로 사용자들이 할 수 있는 것을 나열 
      - 어떻게 - 무엇을 단계별로 분해해 나열 
      - 입력(원천) - 각 단계를 진행하기 위해 필요한 요소들과 그것들의 원천을 나열(누락된 누가, 무엇을, 또는 어떻게를 찾기 위함)
      - 출력(사용처) - 각 단계의 반환과 그 쓰임새를 나열(누락된 누가, 무엇 또는 어떻게를 찾기 위함)
      - 목표 - 명시적이고 간결하게 각각의 어떻게 + 입력 + 출력을 재구성 
  #### 2.4 API 디자인에서 피해야 할 프로바이더 관점 
    - 불필요하게 데이터 모델을 사용자들에게 노출해 불편함을 유발하지 않도록 주의해야 한다. 
    - 내부의 비즈니스 로직을 노출하는 것은 API 의 컨슈머가 이해하기도 어렵고 사용하기도 어렵게 만든다. **사용자들이 해당 API 로 무엇을 할 수 있는지에 집중하도록 하자.**
    - 드러나지 않아야 하는 소프트웨어 아키텍쳐와 API 디자인을 매핑시키는 것은 컨슈머가 API 를 이해하기도 사용하기도 어렵게 만든다. **소프트웨어 아키텍쳐는 항상 숨겨져야 한다.**
    
### 3. 프로그래밍 인터페이스 디자인 하기 
- 
  #### 3.1 REST API 소개 
  - 예시) GET /products/{productId}
  - 경로 : 서버상의 리소스를 식별할 수 있는 주소(여기서는 productId)
  - HTTP 메서드 : 이 리소스를 가지고 무슨 행위를 하고 싶은지 표시해주는 역할(여기서는 GET)
  - **REST**는 Representational State Transfer 를 의미한다. 
  - 자원을 이름(자원의 표현)으로 구분하여 해당 자원의 상태(정보)를 주고 받는 모든 것을 의미한다.
  - 월드 와이드 웹(www)과 같은 분산 하이퍼미디어 시스템을 위한 소프트웨어 개발 아키텍처의 한 형식
  - HTTP URI(Uniform Resource Identifier)를 통해 자원(Resource)을 명시하고, HTTP Method(POST, GET, PUT, DELETE)를 통해 해당 자원에 대한 CRUD Operation을 적용하는 것을 의미한다.
  
  #### 3.2 API 목표를 REST API 로 변환하는 과정 
  - API 목표 캔버스로 리소스와 리소스 사이 관계 식별 
    - 리소스들은 다른 리로스들과 관계가 있을 수도, 없을 수도 있다. 또한 일정한 타입의 리소스 여러 개를 포함하는 리소스도 있다. 이런 리소스를 **콜렉션 리소스** 또는 단순하게 **콜렉션** 이라고 말한다. 
  - API 목표 캔버스를 이용해 액션과 액션의 파라미터 그리고 반환값 식별 
    - REST API 는 **액션과 리소스를 통해서 목표를 표현한다.**
    - 액션은 목표의 주요 동사이고, 목표의 핵심 리소스에 영향을 준다. 
  - 경로를 포함한 리소스 표현 
    - REST 리소스의 경로는 반드시 유일해야 한다. 
    - API 는 사용자들이 경로를 해석하기 쉬워야 하기에 경로에서 더 많은 정보를 제공할수록 더 좋다. 
  - HTTP 로 액션 표현 
    - PATCH HTTP 메서드는 리소스의 부분 수정을 할 때 주로 쓰인다.
    - PUT HTTP 메서드는 경로에 부합하는 리소스를 완전히 교체하고, 없는 경우 새로 생성해낼 수 있다. 후자 같은 경우에는 POST 로 추가하는 액션과 완전히 동일한 효과가 발생해야 하며, POST 와 마찬가지로 리퀘스트의 파라미터들은 바디에 포함되어야 한다. 
    
  #### 3.3 API 데이터 디자인하기
    - 컨슈머가 반드시 데이터를 이해하도록 만드는 동시에 내부 동작 원리를 노출하지 않는 디자인을 만들어야 한다. 
    - 반드시 각 속성이 프로바이더 관점이 아닌 컨슈머 관점으로 디자인 되도록 주의를 기울여야 한다. 
    - **속성의 타입을 정할 땐, 되도록 기본 데이터 타입을 써서 여러 프로그래밍 언어에서 지원할 수 있도록 해주어야 한다.**(숫자,일자,불리언 등등)
    - 액션의 컨텍스트에 맞게 리스폰스를 재조정 해야한다. 
    - **파라미터는 반드시 필요한 데이터만을 제공해야 하고 불필요한 정보는 제공해서는 안된다. 또한, 백엔드가 자체적으로 처리할 수 있는 데이터를 포함해서도 안된다.**
    - 액션을 표현하는 데는 동사가 쓰인다. 즉, **액션 리소스**는 함수를 표현한다고 보면 왼다.
  #### 3.4 RESTful 한 소프트웨어 아키텍처를 위한 여섯 가지 제약 사항
    - 클라이언트 / 서버 분리 : 서로 커뮤니케이션하는 클라이언트와 서버, 가령 모바일 애플리케이션의 동작 방식과 API 를 제공하는 서버의 동작 방식에 대해 분리해서 생각해야 한다.
    - 스테이트리스(Stateless) : 리퀘스트를 처리하는데 필요한 모든 정보는 해당 리퀘스트에 포함되어 있어야 한다. 서버는 리퀘스트를 처리하는데 필요한 클라이언트의 그 어떤 컨텍스트도 서버의 세션에 담지 않는다.
    - 캐시 가능성(Cacheability) : 리퀘스트에 대한 리스폰스는 저장 가능 여부(클라이언트가 동일한 요청을 다시 하지 않고 재사용할 수 있도록) 및 기간을 표시해야 한다. 
    - 레이어드 시스템(Layered system) : 클라이언트가 서버와 상호작용을 할 때, 오직 서버만을 알고 있어야 한다. 서버를 이루는 인프라스트럭쳐는 뒷단에 숨겨져 있어야 한다. 클라이언트는 오직 시스템에서 하나의 레이어만 볼 수 있어야 한다.
    - 코드 온 디멘드(Code on demand) : 서버는 필요하다면 클라이언트에 실행 가능한 코드를 전송할 수 있어야 한다.(예: Javascript) 이 제약사항은 선택적이다. 
    - 유니폼 인터페이스(Uniform interface) : 모든 상호작용은 식별된 리소스의 개념에 따라 이루어져야 한다. 이는 식별된 리소스의 조작은 리소스의 상태 표현들과 표준 메서드들을 통해서만 이뤄짐을 의미한다. 또한, 상호작용은 리소스의 표현이 무엇을 의미하는지와 이 리소스들로 무엇을 할 수 있는지 알려줄 수 있는 메타데이터를 제공해야 한다.
